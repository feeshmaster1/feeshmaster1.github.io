<!DOCTYPE html>
<html>
<head>
    <title>Discord-Style Chat Room</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" href="favicon.png" type="image/png">
</head>
<body>
    <div id="login-container">
        <h1>Login to the Chat Room</h1>
        <form id="login-form">
            <input type="text" id="username-input" placeholder="Enter your username..." required>
            <button type="submit" id="login-button">Login</button>
        </form>
    </div>

    <div id="chat-container" style="display: none;">
        <div id="chat-header">
            <h1>Welcome to the Chat Room</h1>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input">
            <input type="text" id="message-input" placeholder="Type your message..." disabled>
            <button id="send-button" disabled>send</button>
        </div>
    </div>

    <script>
alert("please dont be too toxic or use too much foul language as we may have to ban you.")      
const loginContainer = document.getElementById('login-container');
const chatContainer = document.getElementById('chat-container');
const loginForm = document.getElementById('login-form');
const usernameInput = document.getElementById('username-input');
const passwordInput = "hr4t"
const chatMessages = document.getElementById('chat-messages');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
const socket = new WebSocket('wss://chatroom-websocket.coolgamermoth.repl.co');

loginForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const username = usernameInput.value;
    const password = btoa(passwordInput); 
        loginContainer.style.display = 'none';
        chatContainer.style.display = 'block';
        enableChatInput();
});

socket.addEventListener('open', (event) => {
    console.log('WebSocket connection opened.');
    socket.send(JSON.stringify({ request: 'get_chat_history' }));
});

socket.addEventListener('message', (event) => {
    const data = JSON.parse(event.data);
    if (data.request === 'get_chat_history') {
        loadChatHistory(data.history); 
    } else {
        appendMessage(data.sender, data.message, data.timestamp);
    }
});

function loadChatHistory(chatHistoryData) {
    if (chatMessages.innerHTML === '') {
        chatMessages.innerHTML = '';
    }
    chatHistoryData.forEach((messageData) => {
        appendMessage(messageData.sender, messageData.message, messageData.timestamp);
    });
}

sendButton.addEventListener('click', () => {
    const message = messageInput.value;
    const username = usernameInput.value;
    if (message.trim() !== '' && username.trim() !== '') {
        sendMessage(username, message);
        appendMessage(username, message, new Date().toISOString());
        messageInput.value = '';
    }
});

messageInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
        event.preventDefault();
        sendButton.click();
    }
});

function sendMessage(sender, message) {
    if (socket.readyState === WebSocket.OPEN) {
        const timestamp = new Date().toISOString();
        const messageData = {
            sender: sender,
            message: message,
            timestamp: timestamp,
        };
        socket.send(JSON.stringify(messageData));
    } else {
        console.error('WebSocket is not in an open state. Cannot send message.');
    }
}

function appendMessage(sender, message, timestamp) {
    const messageElement = document.createElement('div');
    messageElement.className = 'message';
    const localTimestamp = new Date(timestamp).toLocaleString();
    messageElement.innerHTML = `
        <div class="message-sender">${sender}</div>
        <div class="message-text">${message}</div>
        <div class="message-timestamp">${localTimestamp}</div>
    `;
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function enableChatInput() {
    messageInput.removeAttribute('disabled');
    sendButton.removeAttribute('disabled');
}
</script>
</body>
</html>
